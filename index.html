<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K.R.O Contracts - Full Working Version</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: #f5f5f5;
            padding: 20px;
        }
        
        /* Header */
        .header {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .logo {
            font-size: 1.5em;
            font-weight: bold;
            color: #d32f2f;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .nav-btn {
            padding: 8px 20px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            border-radius: 20px;
        }
        
        .nav-btn.active {
            background: #d32f2f;
            color: white;
        }
        
        /* Action Bar */
        .action-bar {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .search-box {
            flex: 1;
            display: flex;
            background: #f5f5f5;
            border-radius: 8px;
            padding: 0 15px;
        }
        
        .search-box input {
            flex: 1;
            padding: 10px 0;
            border: none;
            background: transparent;
            outline: none;
        }
        
        .filter-btn, .add-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .filter-btn {
            background: #f5f5f5;
        }
        
        .add-btn {
            background: #d32f2f;
            color: white;
        }
        
        /* Contracts Grid */
        .contracts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .contract-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            border-left: 4px solid;
            transition: transform 0.2s;
        }
        
        .contract-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .contract-card[data-status="In Progress"] {
            border-left-color: #ff9800;
        }
        
        .contract-card[data-status="Completed"] {
            border-left-color: #4caf50;
        }
        
        .contract-card[data-status="Not Started"] {
            border-left-color: #f44336;
        }
        
        .contract-amount {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .contract-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .contract-company {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .contract-meta {
            display: flex;
            justify-content: space-between;
            color: #999;
            font-size: 0.85em;
            margin-top: 10px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
        }
        
        .status-badge.in-progress {
            background: #fff3e0;
            color: #ff9800;
        }
        
        .status-badge.completed {
            background: #e8f5e8;
            color: #4caf50;
        }
        
        .status-badge.not-started {
            background: #ffebee;
            color: #f44336;
        }
        
        /* Progress List */
        .progress-list {
            background: white;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .progress-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .progress-item:hover {
            background: #f9f9f9;
        }
        
        .progress-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 15px;
        }
        
        .progress-status.in-progress { background: #ff9800; }
        .progress-status.completed { background: #4caf50; }
        .progress-status.not-started { background: #f44336; }
        
        .progress-content {
            flex: 1;
        }
        
        .progress-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .progress-date {
            color: #999;
            font-size: 0.85em;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .close-btn {
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }
        
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .btn-primary {
            width: 100%;
            padding: 12px;
            background: #d32f2f;
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .btn-primary:hover {
            background: #b71c1c;
        }
        
        .btn-secondary {
            padding: 8px 20px;
            background: #f5f5f5;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        /* Filter Options */
        .filter-option {
            padding: 12px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            background: #f5f5f5;
        }
        
        .filter-option:hover {
            background: #e0e0e0;
        }
        
        .filter-option.selected {
            background: #d32f2f;
            color: white;
        }
        
        .filter-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        /* Detail View */
        .detail-grid {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
        }
        
        .detail-row {
            display: grid;
            grid-template-columns: 100px 1fr;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }
        
        .detail-label {
            color: #666;
            font-weight: 500;
        }
        
        .submitted-by {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }
        
        .submitted-by img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }
        
        /* Status Message */
        .status-message {
            margin: 20px 0;
            padding: 15px;
            background: #e8f5e8;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            color: #155724;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">K.R.O <span>Contracts</span></div>
        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showPage('home')">Home</button>
            <button class="nav-btn" onclick="showPage('progress')">Progress</button>
        </div>
    </div>

    <!-- Status Message -->
    <div class="status-message" id="statusMessage">
        ‚úÖ App loaded. Click + Add to create a new contract.
    </div>

    <!-- Action Bar -->
    <div class="action-bar">
        <div class="search-box">
            <span style="color: #999; margin-right: 10px;">üîç</span>
            <input type="text" placeholder="Search contracts..." id="searchInput" onkeyup="searchContracts()">
        </div>
        <button class="filter-btn" onclick="openFilterModal()">
            üìä Filter
        </button>
        <button class="add-btn" onclick="openAddModal()">
            + Add
        </button>
    </div>

    <!-- Home Page -->
    <div id="homePage">
        <div class="contracts-grid" id="contractsGrid">
            <!-- Contracts will be loaded here -->
        </div>
    </div>

    <!-- Progress Page -->
    <div id="progressPage" style="display: none;">
        <div class="progress-list" id="progressList">
            <!-- Progress items will be loaded here -->
        </div>
    </div>

    <!-- Filter Modal -->
    <div class="modal" id="filterModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Filter by Status</h3>
                <span class="close-btn" onclick="closeFilterModal()">&times;</span>
            </div>
            
            <div class="filter-option" onclick="selectFilter('all')" id="filterAll">
                üìã All Contracts
            </div>
            <div class="filter-option" onclick="selectFilter('In Progress')" id="filterInProgress">
                ‚è≥ In Progress
            </div>
            <div class="filter-option" onclick="selectFilter('Completed')" id="filterCompleted">
                ‚úÖ Completed
            </div>
            <div class="filter-option" onclick="selectFilter('Not Started')" id="filterNotStarted">
                ‚ö†Ô∏è Not Started
            </div>
            
            <div class="filter-actions">
                <button onclick="clearFilter()" class="btn-secondary">Clear all</button>
                <button onclick="applyFilter()" style="background: #d32f2f; color: white; border: none; padding: 8px 25px; border-radius: 5px; cursor: pointer;">Done</button>
            </div>
        </div>
    </div>

    <!-- Add Contract Modal -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New Contract</h2>
                <span class="close-btn" onclick="closeAddModal()">&times;</span>
            </div>
            
            <form id="addContractForm" onsubmit="saveNewContract(event)">
                <div class="form-group">
                    <label>Company</label>
                    <input type="text" id="company" placeholder="e.g., K.R.O Services" required>
                </div>
                
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="description" placeholder="Describe the contract..." required></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Duration</label>
                        <input type="text" id="duration" placeholder="e.g., 2 Days Contract" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Worker ID</label>
                        <input type="text" id="workerId" placeholder="e.g., wrk-012" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Amount (‚Ç¶)</label>
                        <input type="number" id="amount" placeholder="20000" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Status</label>
                        <select id="status">
                            <option value="Not Started">Not Started</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Completed">Completed</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Submission Date</label>
                    <input type="date" id="submissionDate" required>
                </div>
                
                <button type="submit" class="btn-primary">Create Contract</button>
            </form>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="detailTitle">Contract Details</h2>
                <span class="close-btn" onclick="closeDetailModal()">&times;</span>
            </div>
            
            <div class="detail-grid" id="detailContent">
                <!-- Detail content will be loaded here -->
            </div>
            
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button class="btn-secondary" onclick="openEditModal()" style="flex: 1;">‚úèÔ∏è Edit</button>
                <button class="btn-primary" onclick="openUpdateStatusModal()" style="flex: 1;">üìä Update Status</button>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Contract</h2>
                <span class="close-btn" onclick="closeEditModal()">&times;</span>
            </div>
            
            <form id="editContractForm" onsubmit="updateContract(event)">
                <input type="hidden" id="editContractId">
                
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="editDescription" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Duration</label>
                    <input type="text" id="editDuration" required>
                </div>
                
                <div class="form-group">
                    <label>Worker ID</label>
                    <input type="text" id="editWorkerId" required>
                </div>
                
                <div class="form-group">
                    <label>Amount (‚Ç¶)</label>
                    <input type="number" id="editAmount" required>
                </div>
                
                <div class="form-group">
                    <label>Submission Date</label>
                    <input type="date" id="editSubmissionDate" required>
                </div>
                
                <button type="submit" class="btn-primary">Update Contract</button>
            </form>
        </div>
    </div>

    <!-- Update Status Modal -->
    <div class="modal" id="statusModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Update Status</h2>
                <span class="close-btn" onclick="closeStatusModal()">&times;</span>
            </div>
            
            <form id="updateStatusForm" onsubmit="updateContractStatus(event)">
                <input type="hidden" id="statusContractId">
                
                <div class="form-group">
                    <label>New Status</label>
                    <select id="newStatus">
                        <option value="Not Started">Not Started</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Completed">Completed</option>
                    </select>
                </div>
                
                <button type="submit" class="btn-primary">Update Status</button>
            </form>
        </div>
    </div>

    <script>
        // ==================== INITIAL DATA ====================
        let contracts = [
            {
                id: 1,
                amount: '20000',
                title: 'Cleaning Lady Needed',
                company: 'K.R.O Services',
                status: 'In Progress',
                submissionDate: '2023-02-12',
                duration: '2 Days Contract',
                description: 'To work with K.R.O Cleaning Service on a two days cleaning contract at Maitama',
                workerId: 'wrk-012',
                submittedBy: 'Sophia Patel',
                submittedEmail: 'spatel@careconnect.com',
                avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Sophia'
            },
            {
                id: 2,
                amount: '15000',
                title: 'harassment',
                company: 'Workplace Resolution',
                status: 'Completed',
                submissionDate: '2024-06-18',
                duration: '1 Day Contract',
                description: 'Workplace harassment mediation session',
                workerId: 'wrk-023',
                submittedBy: 'John Doe',
                submittedEmail: 'jdoe@company.com',
                avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=John'
            },
            {
                id: 3,
                amount: '5000',
                title: 'mental health',
                company: 'Employee Wellness',
                status: 'Not Started',
                submissionDate: '2023-09-10',
                duration: '3 Days Contract',
                description: 'Mental health awareness session',
                workerId: 'wrk-045',
                submittedBy: 'Jane Smith',
                submittedEmail: 'jsmith@company.com',
                avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Jane'
            }
        ];

        // ==================== GLOBAL VARIABLES ====================
        let currentFilter = 'all';
        let currentPage = 'home';
        let selectedContractId = null;

        // ==================== INITIAL LOAD ====================
        window.onload = function() {
            loadFromStorage();
            displayContracts();
            displayProgress();
            updateStatus('App loaded successfully');
        };

        // ==================== LOCAL STORAGE ====================
        function saveToStorage() {
            localStorage.setItem('kro_contracts', JSON.stringify(contracts));
        }

        function loadFromStorage() {
            const saved = localStorage.getItem('kro_contracts');
            if (saved) {
                contracts = JSON.parse(saved);
            }
        }

        // ==================== DISPLAY FUNCTIONS ====================
        function displayContracts() {
            const filtered = filterContracts(contracts);
            const grid = document.getElementById('contractsGrid');
            
            if (filtered.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 50px; color: #999;">No contracts found</div>';
                return;
            }
            
            grid.innerHTML = filtered.map(contract => `
                <div class="contract-card" data-status="${contract.status}" onclick="viewContract(${contract.id})">
                    <div class="contract-amount">‚Ç¶${parseFloat(contract.amount).toLocaleString()}</div>
                    <div class="contract-title">${contract.title}</div>
                    <div class="contract-company">at ${contract.company}</div>
                    <div class="contract-meta">
                        <span class="status-badge ${contract.status.toLowerCase().replace(' ', '-')}">${contract.status}</span>
                        <span>üìÖ ${new Date(contract.submissionDate).toLocaleDateString()}</span>
                    </div>
                </div>
            `).join('');
        }

        function displayProgress() {
            const filtered = filterContracts(contracts);
            const list = document.getElementById('progressList');
            
            if (filtered.length === 0) {
                list.innerHTML = '<div style="text-align: center; padding: 50px; color: #999;">No contracts found</div>';
                return;
            }
            
            list.innerHTML = filtered.map(contract => `
                <div class="progress-item" onclick="viewContract(${contract.id})">
                    <div class="progress-status ${contract.status.toLowerCase().replace(' ', '-')}"></div>
                    <div class="progress-content">
                        <div class="progress-title">
                            <span style="font-weight: 600;">${contract.status.toUpperCase()}</span> ‚Äî ${contract.title}
                        </div>
                        <div class="progress-date">Posted on ${new Date(contract.submissionDate).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</div>
                    </div>
                </div>
            `).join('');
        }

        // ==================== FILTER FUNCTIONS ====================
        function filterContracts(contractsList) {
            if (currentFilter === 'all') return contractsList;
            return contractsList.filter(c => c.status === currentFilter);
        }

        function selectFilter(status) {
            currentFilter = status;
            document.querySelectorAll('.filter-option').forEach(opt => opt.classList.remove('selected'));
            const filterId = status === 'all' ? 'filterAll' : `filter${status.replace(' ', '')}`;
            document.getElementById(filterId).classList.add('selected');
        }

        function applyFilter() {
            closeFilterModal();
            displayContracts();
            displayProgress();
            updateStatus(`Filter applied: ${currentFilter}`);
        }

        function clearFilter() {
            currentFilter = 'all';
            document.querySelectorAll('.filter-option').forEach(opt => opt.classList.remove('selected'));
            document.getElementById('filterAll').classList.add('selected');
            displayContracts();
            displayProgress();
            updateStatus('Filter cleared');
        }

        // ==================== SEARCH FUNCTION ====================
        function searchContracts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            if (searchTerm === '') {
                displayContracts();
                return;
            }
            
            const filtered = contracts.filter(c => 
                c.title.toLowerCase().includes(searchTerm) || 
                c.company.toLowerCase().includes(searchTerm) ||
                c.description.toLowerCase().includes(searchTerm)
            );
            
            if (currentPage === 'home') {
                const grid = document.getElementById('contractsGrid');
                if (filtered.length === 0) {
                    grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 50px; color: #999;">No contracts found</div>';
                } else {
                    grid.innerHTML = filtered.map(contract => `
                        <div class="contract-card" data-status="${contract.status}" onclick="viewContract(${contract.id})">
                            <div class="contract-amount">‚Ç¶${parseFloat(contract.amount).toLocaleString()}</div>
                            <div class="contract-title">${contract.title}</div>
                            <div class="contract-company">at ${contract.company}</div>
                            <div class="contract-meta">
                                <span class="status-badge ${contract.status.toLowerCase().replace(' ', '-')}">${contract.status}</span>
                                <span>üìÖ ${new Date(contract.submissionDate).toLocaleDateString()}</span>
                            </div>
                        </div>
                    `).join('');
                }
            }
            
            updateStatus(`Searching for: ${searchTerm}`);
        }

        // ==================== PAGE NAVIGATION ====================
        function showPage(page) {
            currentPage = page;
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (page === 'home') {
                document.getElementById('homePage').style.display = 'block';
                document.getElementById('progressPage').style.display = 'none';
                updateStatus('Home page');
            } else {
                document.getElementById('homePage').style.display = 'none';
                document.getElementById('progressPage').style.display = 'block';
                updateStatus('Progress page');
            }
        }

        // ==================== MODAL FUNCTIONS ====================
        function openFilterModal() {
            document.getElementById('filterModal').style.display = 'flex';
        }

        function closeFilterModal() {
            document.getElementById('filterModal').style.display = 'none';
        }

        function openAddModal() {
            document.getElementById('addModal').style.display = 'flex';
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('submissionDate').value = today;
        }

        function closeAddModal() {
            document.getElementById('addModal').style.display = 'none';
            document.getElementById('addContractForm').reset();
        }

        // ==================== SAVE NEW CONTRACT ====================
        function saveNewContract(event) {
            event.preventDefault();
            
            const description = document.getElementById('description').value;
            const title = description.split(' ').slice(0, 3).join(' ') + '...';
            
            const newContract = {
                id: Date.now(), // Use timestamp as unique ID
                amount: document.getElementById('amount').value,
                title: title,
                company: document.getElementById('company').value,
                status: document.getElementById('status').value,
                submissionDate: document.getElementById('submissionDate').value,
                duration: document.getElementById('duration').value,
                description: description,
                workerId: document.getElementById('workerId').value,
                submittedBy: 'Admin',
                submittedEmail: 'admin@kro.com',
                avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Admin'
            };

            contracts.push(newContract);
            saveToStorage();
            
            closeAddModal();
            displayContracts();
            displayProgress();
            updateStatus('New contract created successfully!');
        }

        // ==================== VIEW CONTRACT DETAIL ====================
        function viewContract(id) {
            selectedContractId = id;
            const contract = contracts.find(c => c.id === id);
            
            document.getElementById('detailTitle').textContent = contract.title;
            document.getElementById('detailContent').innerHTML = `
                <div class="detail-row">
                    <div class="detail-label">Description</div>
                    <div class="detail-value">${contract.description}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Duration</div>
                    <div class="detail-value">${contract.duration}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Worker ID</div>
                    <div class="detail-value">${contract.workerId}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Status</div>
                    <div class="detail-value">
                        <span class="status-badge ${contract.status.toLowerCase().replace(' ', '-')}">${contract.status}</span>
                    </div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Amount</div>
                    <div class="detail-value">‚Ç¶${parseFloat(contract.amount).toLocaleString()}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Submission Date</div>
                    <div class="detail-value">${new Date(contract.submissionDate).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</div>
                </div>
                <div class="submitted-by">
                    <img src="${contract.avatar}" alt="">
                    <div class="submitted-info">
                        <h4>${contract.submittedBy}</h4>
                        <p>${contract.submittedEmail}</p>
                    </div>
                </div>
            `;
            
            // Pre-fill edit form
            document.getElementById('editContractId').value = contract.id;
            document.getElementById('editDescription').value = contract.description;
            document.getElementById('editDuration').value = contract.duration;
            document.getElementById('editWorkerId').value = contract.workerId;
            document.getElementById('editAmount').value = contract.amount;
            document.getElementById('editSubmissionDate').value = contract.submissionDate;
            
            // Pre-fill status modal
            document.getElementById('statusContractId').value = contract.id;
            document.getElementById('newStatus').value = contract.status;
            
            document.getElementById('detailModal').style.display = 'flex';
        }

        function closeDetailModal() {
            document.getElementById('detailModal').style.display = 'none';
        }

        // ==================== EDIT FUNCTIONS ====================
        function openEditModal() {
            closeDetailModal();
            document.getElementById('editModal').style.display = 'flex';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        function updateContract(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('editContractId').value);
            const index = contracts.findIndex(c => c.id === id);
            
            if (index !== -1) {
                const description = document.getElementById('editDescription').value;
                
                contracts[index] = {
                    ...contracts[index],
                    description: description,
                    duration: document.getElementById('editDuration').value,
                    workerId: document.getElementById('editWorkerId').value,
                    amount: document.getElementById('editAmount').value,
                    submissionDate: document.getElementById('editSubmissionDate').value,
                    title: description.split(' ').slice(0, 3).join(' ') + '...'
                };
                
                saveToStorage();
                closeEditModal();
                displayContracts();
                displayProgress();
                updateStatus('Contract updated successfully');
            }
        }

        // ==================== STATUS UPDATE FUNCTIONS ====================
        function openUpdateStatusModal() {
            closeDetailModal();
            document.getElementById('statusModal').style.display = 'flex';
        }

        function closeStatusModal() {
            document.getElementById('statusModal').style.display = 'none';
        }

        function updateContractStatus(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('statusContractId').value);
            const newStatus = document.getElementById('newStatus').value;
            const index = contracts.findIndex(c => c.id === id);
            
            if (index !== -1) {
                contracts[index].status = newStatus;
                saveToStorage();
                closeStatusModal();
                displayContracts();
                displayProgress();
                updateStatus(`Status updated to: ${newStatus}`);
            }
        }

        // ==================== UTILITY ====================
        function updateStatus(message) {
            document.getElementById('statusMessage').innerHTML = `‚úÖ ${message}`;
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = ['filterModal', 'addModal', 'detailModal', 'editModal', 'statusModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        };
    </script>
</body>
</html>