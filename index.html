<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K.R.O Contracts - Workplace Support System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: #f5f5f5;
            color: #333;
            overflow-x: hidden;
        }
        
        /* App Bar / Header */
        .app-bar {
            background: white;
            padding: 15px 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo {
            font-size: 1.5em;
            font-weight: 700;
            color: #d32f2f;
        }
        
        .logo span {
            color: #333;
            font-weight: 400;
        }
        
        .nav-buttons {
            display: flex;
            gap: 20px;
        }
        
        .nav-btn {
            padding: 8px 20px;
            border: none;
            background: transparent;
            font-size: 1em;
            cursor: pointer;
            color: #666;
            border-radius: 20px;
        }
        
        .nav-btn.active {
            background: #d32f2f;
            color: white;
        }
        
        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            transition: filter 0.3s ease;
        }
        
        .container.blur {
            filter: blur(5px);
            pointer-events: none;
        }
        
        /* Search & Filter Bar */
        .action-bar {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .search-box {
            flex: 1;
            display: flex;
            align-items: center;
            background: #f5f5f5;
            border-radius: 8px;
            padding: 0 15px;
        }
        
        .search-box input {
            flex: 1;
            padding: 12px 0;
            border: none;
            background: transparent;
            outline: none;
            font-size: 1em;
        }
        
        .filter-btn {
            padding: 12px 25px;
            background: #f5f5f5;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .add-btn {
            padding: 12px 25px;
            background: #d32f2f;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Filter Dropdown Modal */
        .filter-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .filter-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            width: 90%;
            max-width: 350px;
        }
        
        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .filter-option {
            padding: 12px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .filter-option:hover {
            background: #f5f5f5;
        }
        
        .filter-option.selected {
            background: #d32f2f;
            color: white;
        }
        
        .filter-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        /* Contracts Grid */
        .contracts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .contract-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border-left: 4px solid;
        }
        
        .contract-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .contract-card[data-status="In Progress"] {
            border-left-color: #ff9800;
        }
        
        .contract-card[data-status="Completed"] {
            border-left-color: #4caf50;
        }
        
        .contract-card[data-status="Not Started"] {
            border-left-color: #f44336;
        }
        
        .contract-amount {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 10px;
            color: #333;
        }
        
        .contract-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .contract-company {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .contract-meta {
            display: flex;
            justify-content: space-between;
            color: #999;
            font-size: 0.85em;
            margin-top: 10px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }
        
        .status-badge.in-progress {
            background: #fff3e0;
            color: #ff9800;
        }
        
        .status-badge.completed {
            background: #e8f5e8;
            color: #4caf50;
        }
        
        .status-badge.not-started {
            background: #ffebee;
            color: #f44336;
        }
        
        /* Progress Report Page */
        .progress-list {
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .progress-item:hover {
            background: #f9f9f9;
        }
        
        .progress-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 15px;
        }
        
        .progress-status.in-progress { background: #ff9800; }
        .progress-status.completed { background: #4caf50; }
        .progress-status.not-started { background: #f44336; }
        
        .progress-content {
            flex: 1;
        }
        
        .progress-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .progress-date {
            color: #999;
            font-size: 0.85em;
        }
        
        /* YouTube Banners Section */
        .youtube-section {
            margin: 50px 0 30px;
            padding: 20px 0;
            border-top: 2px solid #eee;
        }
        
        .section-title {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title span {
            background: #ff0000;
            color: white;
            padding: 5px 15px;
            border-radius: 25px;
            font-size: 0.8em;
        }
        
        .banners-container {
            position: relative;
            width: 100%;
            overflow: hidden;
            border-radius: 15px;
        }
        
        .banners-slider {
            display: flex;
            transition: transform 0.5s ease;
        }
        
        .banner-slide {
            min-width: 100%;
            padding: 0 10px;
        }
        
        .youtube-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 40px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: transform 0.3s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .youtube-banner:hover {
            transform: scale(1.02);
        }
        
        .banner-content {
            flex: 1;
        }
        
        .banner-content h3 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .banner-content p {
            opacity: 0.9;
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        
        .banner-stats {
            display: flex;
            gap: 30px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.8em;
            font-weight: 700;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .banner-button {
            background: white;
            color: #333;
            padding: 15px 30px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 600;
            display: inline-block;
            transition: transform 0.3s;
        }
        
        .banner-button:hover {
            transform: scale(1.05);
        }
        
        .banner-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            margin-left: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .slider-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .slider-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ddd;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .slider-dot.active {
            background: #d32f2f;
        }
        
        /* Task Popup Modal */
        .task-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .task-content {
            background: white;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .task-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .task-header h2 {
            color: #d32f2f;
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .task-header p {
            color: #666;
        }
        
        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }
        
        .progress-steps::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: #eee;
            z-index: 1;
        }
        
        .step {
            position: relative;
            z-index: 2;
            background: white;
            padding: 0 10px;
            text-align: center;
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #f5f5f5;
            color: #999;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 5px;
            font-weight: 600;
        }
        
        .step.completed .step-number {
            background: #4caf50;
            color: white;
        }
        
        .step-label {
            font-size: 0.8em;
            color: #666;
        }
        
        .task-item {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .task-title {
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .task-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .task-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            text-align: center;
            text-decoration: none;
            transition: background 0.3s;
        }
        
        .task-btn.primary {
            background: #ff0000;
            color: white;
        }
        
        .task-btn.secondary {
            background: #e0e0e0;
            color: #333;
        }
        
        .task-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .upload-status {
            display: flex;
            align-items: center;
            margin-top: 10px;
            color: #4caf50;
            font-size: 0.9em;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }
        
        .image-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 2px dashed #ddd;
            margin: 10px 0;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .submit-btn {
            width: 100%;
            padding: 15px;
            background: #d32f2f;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 20px;
        }
        
        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .hidden {
            display: none;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            max-width: 600px;
            margin: 40px auto;
            padding: 30px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f5f5f5;
        }
        
        .modal-header h2 {
            font-size: 1.5em;
            color: #333;
        }
        
        .close-btn {
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            resize: vertical;
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn-primary {
            flex: 1;
            padding: 15px;
            background: #d32f2f;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-secondary {
            flex: 1;
            padding: 15px;
            background: #f5f5f5;
            color: #333;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* Contract Detail Page */
        .detail-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .edit-btn, .status-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .edit-btn {
            background: #f5f5f5;
            color: #333;
        }
        
        .status-btn {
            background: #d32f2f;
            color: white;
        }
        
        .detail-grid {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .detail-row {
            display: grid;
            grid-template-columns: 120px 1fr;
            padding: 15px 0;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            color: #666;
            font-weight: 500;
        }
        
        .detail-value {
            color: #333;
        }
        
        .submitted-by {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        
        .submitted-by img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .submitted-info h4 {
            margin-bottom: 5px;
        }
        
        .submitted-info p {
            color: #666;
        }
        
        @media (max-width: 768px) {
            .action-bar {
                flex-wrap: wrap;
            }
            .search-box {
                width: 100%;
                order: 1;
            }
            .filter-btn, .add-btn {
                flex: 1;
            }
            .youtube-banner {
                flex-direction: column;
                text-align: center;
                padding: 30px 20px;
            }
            .banner-avatar {
                margin-left: 0;
                margin-top: 20px;
            }
            .banner-stats {
                justify-content: center;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- App Bar -->
    <div class="app-bar">
        <div class="logo">K.R.O <span>Contracts</span></div>
        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showPage('home')">Home</button>
            <button class="nav-btn" onclick="showPage('progress')">Progress</button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container" id="mainContainer">
        <!-- Home Page -->
        <div id="homePage">
            <div class="action-bar">
                <div class="search-box">
                    <span style="color: #999; margin-right: 10px;">üîç</span>
                    <input type="text" placeholder="Search contracts..." id="searchInput" onkeyup="searchContracts()">
                </div>
                <button class="filter-btn" onclick="openFilterModal()">
                    <span>üìä</span> Filter
                </button>
                <button class="add-btn" onclick="openAddModal()">
                    <span>+</span> Add
                </button>
            </div>

            <div class="contracts-grid" id="contractsGrid">
                <!-- Contracts will be loaded here -->
                <div style="grid-column: 1/-1; text-align: center; padding: 50px; color: #999;">Loading contracts...</div>
            </div>

            <!-- YouTube Growth Banners Section -->
            <div class="youtube-section">
                <div class="section-title">
                    üé• YouTube Creator Community <span>Support & Grow Together</span>
                </div>
                
                <div class="banners-container">
                    <div class="banners-slider" id="bannersSlider">
                        <!-- Banners will be loaded here -->
                    </div>
                </div>
                
                <div class="slider-controls" id="sliderControls">
                    <!-- Dots will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Progress Report Page -->
        <div id="progressPage" style="display: none;">
            <div class="action-bar">
                <div class="search-box">
                    <span style="color: #999; margin-right: 10px;">üîç</span>
                    <input type="text" placeholder="Search contracts..." id="progressSearchInput" onkeyup="searchProgress()">
                </div>
                <button class="filter-btn" onclick="openFilterModal()">
                    <span>üìä</span> Filter
                </button>
                <button class="add-btn" onclick="openAddModal()">
                    <span>+</span> Add
                </button>
            </div>

            <div class="progress-list" id="progressList">
                <!-- Progress items will be loaded here -->
                <div style="text-align: center; padding: 50px; color: #999;">Loading contracts...</div>
            </div>
        </div>
    </div>

    <!-- Task Popup Modal -->
    <div class="task-modal" id="taskModal">
        <div class="task-content">
            <div class="task-header">
                <h2>üéØ Join Our Community</h2>
                <p>Complete these steps to unlock full access</p>
            </div>

            <!-- Progress Steps -->
            <div class="progress-steps">
                <div class="step" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-label">Tasks</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-label">Profile</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-label">Complete</div>
                </div>
            </div>

            <!-- Step 1: Tasks -->
            <div id="step1Content">
                <!-- Task 1: Subscribe -->
                <div class="task-item" id="task1">
                    <div class="task-title">
                        <span>üì∫</span> Task 1: Subscribe to our YouTube channel
                    </div>
                    <div class="task-buttons">
                        <a href="https://youtube.com/@YOURCHANNEL" target="_blank" class="task-btn primary">Go to YouTube</a>
                        <label class="task-btn secondary" style="cursor: pointer;">
                            Upload Screenshot
                            <input type="file" accept="image/*" class="hidden" onchange="uploadTaskProof(1, this)">
                        </label>
                    </div>
                    <div id="task1Status" class="upload-status hidden">
                        ‚úÖ Task 1 completed!
                    </div>
                </div>

                <!-- Task 2: Watch Content -->
                <div class="task-item" id="task2">
                    <div class="task-title">
                        <span>üé¨</span> Task 2: Watch any video
                    </div>
                    <div class="task-buttons">
                        <a href="https://youtube.com/@YOURCHANNEL" target="_blank" class="task-btn primary">Watch Videos</a>
                        <label class="task-btn secondary" style="cursor: pointer;">
                            Upload Screenshot
                            <input type="file" accept="image/*" class="hidden" onchange="uploadTaskProof(2, this)">
                        </label>
                    </div>
                    <div id="task2Status" class="upload-status hidden">
                        ‚úÖ Task 2 completed!
                    </div>
                </div>

                <button class="submit-btn" id="nextToProfile" onclick="goToProfileStep()" disabled>Next: Profile Info ‚Üí</button>
            </div>

            <!-- Step 2: Profile Info -->
            <div id="step2Content" style="display: none;">
                <form id="profileForm" onsubmit="submitProfile(event)">
                    <div class="form-group">
                        <label>Your Name</label>
                        <input type="text" id="userName" placeholder="Enter your name" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Your YouTube Channel Link</label>
                        <input type="url" id="youtubeLink" placeholder="https://youtube.com/@yourchannel" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Your Photo</label>
                        <input type="file" id="userPhoto" accept="image/*" onchange="previewUserPhoto(event)" required>
                        <div class="image-preview" id="userPhotoPreview">
                            <span style="color: #999;">Preview</span>
                        </div>
                    </div>
                    
                    <button type="submit" class="submit-btn" id="submitProfileBtn">Submit & Join Community</button>
                </form>
            </div>

            <!-- Step 3: Completion Message -->
            <div id="step3Content" style="display: none; text-align: center;">
                <div style="font-size: 4em; margin: 20px 0;">üéâ</div>
                <h2 style="color: #4caf50; margin-bottom: 20px;">Welcome to the Community!</h2>
                <p style="color: #666; margin-bottom: 30px;">You now have full access to all features.</p>
                <button class="submit-btn" onclick="closeTaskModal()">Start Exploring</button>
            </div>
        </div>
    </div>

    <!-- Filter Modal -->
    <div class="filter-modal" id="filterModal">
        <div class="filter-content">
            <div class="filter-header">
                <h3>Filter by Status</h3>
                <span class="close-btn" onclick="closeFilterModal()">&times;</span>
            </div>
            
            <div class="filter-option" onclick="selectFilter('all')" id="filterAll">
                üìã All Contracts
            </div>
            <div class="filter-option" onclick="selectFilter('In Progress')" id="filterInProgress">
                ‚è≥ In Progress
            </div>
            <div class="filter-option" onclick="selectFilter('Completed')" id="filterCompleted">
                ‚úÖ Completed
            </div>
            <div class="filter-option" onclick="selectFilter('Not Started')" id="filterNotStarted">
                ‚ö†Ô∏è Not Started
            </div>
            
            <div class="filter-actions">
                <button onclick="clearFilter()" style="background: none; border: none; color: #666; cursor: pointer;">Clear all</button>
                <button onclick="applyFilter()" style="background: #d32f2f; color: white; border: none; padding: 8px 25px; border-radius: 5px; cursor: pointer;">Done</button>
            </div>
        </div>
    </div>

    <!-- Add Contract Modal -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New Contract</h2>
                <span class="close-btn" onclick="closeAddModal()">&times;</span>
            </div>
            
            <form id="addContractForm" onsubmit="saveNewContract(event)">
                <div class="form-group">
                    <label>Company</label>
                    <input type="text" id="company" required>
                </div>
                
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="description" rows="3" required></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Duration</label>
                        <input type="text" id="duration" placeholder="e.g., 2 Days Contract" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Linked Worker ID</label>
                        <input type="text" id="workerId" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Amount (‚Ç¶)</label>
                        <input type="number" id="amount" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Status</label>
                        <select id="status">
                            <option value="Not Started">Not Started</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Completed">Completed</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Submission Date</label>
                    <input type="date" id="submissionDate" required>
                </div>
                
                <div class="form-group">
                    <label>Image</label>
                    <input type="file" id="contractImage" accept="image/*" onchange="previewImage(event)">
                    <div class="image-preview" id="imagePreview">
                        <span style="color: #999;">Choose an image...</span>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Submit</button>
                    <button type="button" class="btn-secondary" onclick="closeAddModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Contract Detail Modal -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="detailTitle">Contract Details</h2>
                <span class="close-btn" onclick="closeDetailModal()">&times;</span>
            </div>
            
            <div class="detail-actions">
                <button class="edit-btn" onclick="openEditModal()">‚úèÔ∏è Edit</button>
                <button class="status-btn" onclick="openUpdateStatusModal()">üìä Update Status</button>
            </div>
            
            <div class="detail-grid" id="detailContent">
                <!-- Detail content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Edit Contract Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Contract</h2>
                <span class="close-btn" onclick="closeEditModal()">&times;</span>
            </div>
            
            <form id="editContractForm" onsubmit="updateContract(event)">
                <input type="hidden" id="editContractId">
                
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="editDescription" rows="3" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Type</label>
                    <input type="text" id="editDuration" required>
                </div>
                
                <div class="form-group">
                    <label>Linked Worker ID</label>
                    <input type="text" id="editWorkerId" required>
                </div>
                
                <div class="form-group">
                    <label>Amount (‚Ç¶)</label>
                    <input type="number" id="editAmount" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Status</label>
                        <select id="editStatus">
                            <option value="Not Started">Not Started</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Completed">Completed</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Submission Date</label>
                        <input type="date" id="editSubmissionDate" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Image</label>
                    <input type="file" id="editImage" accept="image/*" onchange="previewEditImage(event)">
                    <div class="image-preview" id="editImagePreview"></div>
                </div>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Update Contract</button>
                    <button type="button" class="btn-secondary" onclick="closeEditModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Update Status Modal -->
    <div class="modal" id="statusModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Update Contract Status</h2>
                <span class="close-btn" onclick="closeStatusModal()">&times;</span>
            </div>
            
            <form id="updateStatusForm" onsubmit="updateContractStatus(event)">
                <input type="hidden" id="statusContractId">
                
                <div class="form-group">
                    <label>New Status</label>
                    <select id="newStatus">
                        <option value="Not Started">Not Started</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Completed">Completed</option>
                    </select>
                </div>
                
                <button type="submit" class="btn-primary" style="margin-top: 20px;">Update Status</button>
            </form>
        </div>
    </div>

    <script>
        // ==================== SUPABASE CONFIGURATION ====================
        // REPLACE THESE WITH YOUR ACTUAL SUPABASE CREDENTIALS
        const SUPABASE_URL = 'https://alstwqjloygtixumjqvu.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_kd3TziVC0QM_-IF0IcFqFw_nHCwPkkj';
        
        // Initialize Supabase
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // ==================== GLOBAL VARIABLES ====================
        let currentFilter = 'all';
        let currentPage = 'home';
        let selectedContract = null;
        let contracts = [];
        let youtubeCreators = [];
        let currentBannerIndex = 0;
        let bannerInterval;
        let tasksCompleted = { task1: false, task2: false };
        let hasCompletedOnboarding = localStorage.getItem('kro_onboarding_completed') === 'true';
        let popupTriggered = false;

        // ==================== YOUTUBE CREATORS DATA ====================
        const creators = [
            {
                name: 'Tech with Sarah',
                channel: '@techsarah',
                subscribers: '15.2K',
                videos: '234',
                avatar: 'üë©‚Äçüíª',
                color: 'linear-gradient(135deg, #ff6b6b, #ff8e8e)',
                link: 'https://youtube.com/@techsarah',
                description: 'Tech reviews & tutorials'
            },
            {
                name: 'Mike Gaming',
                channel: '@mikegaming',
                subscribers: '28.7K',
                videos: '567',
                avatar: 'üéÆ',
                color: 'linear-gradient(135deg, #4ecdc4, #45b7d1)',
                link: 'https://youtube.com/@mikegaming',
                description: 'Daily gaming content & live streams'
            },
            {
                name: 'Cooking with Priya',
                channel: '@priyacooks',
                subscribers: '42.3K',
                videos: '189',
                avatar: 'üë©‚Äçüç≥',
                color: 'linear-gradient(135deg, #f9d56e, #f8c471)',
                link: 'https://youtube.com/@priyacooks',
                description: 'Easy recipes & cooking tips'
            },
            {
                name: 'Fitness with Alex',
                channel: '@alexfitness',
                subscribers: '31.8K',
                videos: '312',
                avatar: 'üí™',
                color: 'linear-gradient(135deg, #a8e6cf, #d4edda)',
                link: 'https://youtube.com/@alexfitness',
                description: 'Home workouts & nutrition'
            },
            {
                name: 'Music with James',
                channel: '@jamesmusic',
                subscribers: '53.1K',
                videos: '178',
                avatar: 'üé∏',
                color: 'linear-gradient(135deg, #d4a5a5, #e6b8b8)',
                link: 'https://youtube.com/@jamesmusic',
                description: 'Guitar lessons & music theory'
            }
        ];

        // ==================== ONBOARDING TASKS ====================
        // Show popup when user clicks anywhere on page (if not completed)
        document.addEventListener('click', function() {
            if (!hasCompletedOnboarding && !popupTriggered) {
                popupTriggered = true;
                setTimeout(() => {
                    showTaskModal();
                }, 500); // Small delay for better UX
            }
        });

        function showTaskModal() {
            document.getElementById('mainContainer').classList.add('blur');
            document.getElementById('taskModal').style.display = 'flex';
        }

        function uploadTaskProof(taskNum, input) {
            if (input.files && input.files[0]) {
                tasksCompleted[`task${taskNum}`] = true;
                
                // Update UI
                document.getElementById(`task${taskNum}Status`).classList.remove('hidden');
                document.getElementById(`task${taskNum}`).style.opacity = '0.7';
                
                // Disable upload button
                const uploadBtn = document.querySelector(`#task${taskNum} .task-btn.secondary`);
                uploadBtn.style.opacity = '0.5';
                uploadBtn.style.pointerEvents = 'none';
                
                // Check if both tasks completed
                checkTasksCompletion();
            }
        }

        function checkTasksCompletion() {
            if (tasksCompleted.task1 && tasksCompleted.task2) {
                document.getElementById('nextToProfile').disabled = false;
            }
        }

        function goToProfileStep() {
            // Update steps
            document.getElementById('step1').classList.add('completed');
            
            // Show step 2
            document.getElementById('step1Content').style.display = 'none';
            document.getElementById('step2Content').style.display = 'block';
        }

        async function submitProfile(event) {
            event.preventDefault();
            
            const userName = document.getElementById('userName').value;
            const youtubeLink = document.getElementById('youtubeLink').value;
            const photoFile = document.getElementById('userPhoto').files[0];
            
            let photoUrl = '';
            
            // Upload photo if provided
            if (photoFile) {
                try {
                    photoUrl = await uploadUserPhoto(photoFile);
                } catch (error) {
                    console.error('Photo upload failed:', error);
                }
            }
            
            // Save user data to Supabase
            const userData = {
                name: userName,
                youtube_channel: youtubeLink,
                photo_url: photoUrl,
                completed_tasks: true,
                created_at: new Date().toISOString()
            };
            
            try {
                const { error } = await supabase
                    .from('community_members')
                    .insert([userData]);
                
                if (error) throw error;
                
                // Mark onboarding as completed
                localStorage.setItem('kro_onboarding_completed', 'true');
                hasCompletedOnboarding = true;
                
                // Update steps
                document.getElementById('step2').classList.add('completed');
                document.getElementById('step3').classList.add('completed');
                
                // Show step 3
                document.getElementById('step2Content').style.display = 'none';
                document.getElementById('step3Content').style.display = 'block';
                
            } catch (error) {
                console.error('Error saving user data:', error);
                alert('Error saving your information. Please try again.');
            }
        }

        async function uploadUserPhoto(file) {
            const fileName = `user_${Date.now()}_${file.name}`;
            
            const { data, error } = await supabase.storage
                .from('user-photos')
                .upload(fileName, file);
            
            if (error) throw error;
            
            const { data: { publicUrl } } = supabase.storage
                .from('user-photos')
                .getPublicUrl(fileName);
            
            return publicUrl;
        }

        function previewUserPhoto(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('userPhotoPreview').innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            }
        }

        function closeTaskModal() {
            document.getElementById('taskModal').style.display = 'none';
            document.getElementById('mainContainer').classList.remove('blur');
        }

        // ==================== CONTRACTS FUNCTIONS ====================
        async function loadContracts() {
            try {
                const { data, error } = await supabase
                    .from('contracts')
                    .select('*')
                    .order('submissionDate', { ascending: false });
                
                if (error) throw error;
                
                contracts = data || [];
                displayContracts();
                displayProgress();
            } catch (error) {
                console.error('Error loading contracts:', error);
                // Use sample data if no contracts exist
                contracts = [
                    {
                        id: 1,
                        amount: '20000',
                        title: 'Cleaning Lady Needed',
                        company: 'K.R.O Services',
                        status: 'In Progress',
                        submissionDate: '2023-02-12',
                        duration: '2 Days Contract',
                        description: 'To work with K.R.O Cleaning Service on a two days cleaning contract at Maitama',
                        workerId: 'wrk-012',
                        submittedBy: 'Admin',
                        submittedEmail: 'admin@kro.com',
                        avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Admin'
                    },
                    {
                        id: 2,
                        amount: '15000',
                        title: 'harassment',
                        company: 'Workplace Resolution',
                        status: 'Completed',
                        submissionDate: '2024-06-18',
                        duration: '1 Day Contract',
                        description: 'Workplace harassment mediation session',
                        workerId: 'wrk-023',
                        submittedBy: 'Admin',
                        submittedEmail: 'admin@kro.com',
                        avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Admin'
                    },
                    {
                        id: 3,
                        amount: '5000',
                        title: 'mental health',
                        company: 'Employee Wellness',
                        status: 'Not Started',
                        submissionDate: '2023-09-10',
                        duration: '3 Days Contract',
                        description: 'Mental health awareness session',
                        workerId: 'wrk-045',
                        submittedBy: 'Admin',
                        submittedEmail: 'admin@kro.com',
                        avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Admin'
                    }
                ];
                displayContracts();
                displayProgress();
            }
        }

        function displayContracts() {
            const filtered = filterContracts(contracts);
            const grid = document.getElementById('contractsGrid');
            
            if (!filtered || filtered.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 50px; color: #999;">No contracts found</div>';
                return;
            }
            
            grid.innerHTML = filtered.map(contract => `
                <div class="contract-card" data-status="${contract.status}" onclick="viewContract('${contract.id}')">
                    <div class="contract-amount">‚Ç¶${parseFloat(contract.amount).toLocaleString()}</div>
                    <div class="contract-title">${contract.title || contract.description?.substring(0, 30) + '...'}</div>
                    <div class="contract-company">at ${contract.company}</div>
                    <div class="contract-meta">
                        <span class="status-badge ${contract.status?.toLowerCase().replace(' ', '-')}">${contract.status}</span>
                        <span>üìÖ ${new Date(contract.submissionDate).toLocaleDateString()}</span>
                    </div>
                </div>
            `).join('');
        }

        function displayProgress() {
            const filtered = filterContracts(contracts);
            const list = document.getElementById('progressList');
            
            if (!filtered || filtered.length === 0) {
                list.innerHTML = '<div style="text-align: center; padding: 50px; color: #999;">No contracts found</div>';
                return;
            }
            
            list.innerHTML = filtered.map(contract => `
                <div class="progress-item" onclick="viewContract('${contract.id}')">
                    <div class="progress-status ${contract.status?.toLowerCase().replace(' ', '-')}"></div>
                    <div class="progress-content">
                        <div class="progress-title">
                            <span style="font-weight: 600;">${contract.status?.toUpperCase()}</span> ‚Äî ${contract.title || contract.description?.substring(0, 30) + '...'}
                        </div>
                        <div class="progress-date">Posted on ${new Date(contract.submissionDate).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</div>
                    </div>
                </div>
            `).join('');
        }

        function filterContracts(contractsList) {
            if (currentFilter === 'all') return contractsList;
            return contractsList.filter(c => c.status === currentFilter);
        }

        // ==================== SEARCH FUNCTIONS ====================
        function searchContracts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filtered = contracts.filter(c => 
                c.title?.toLowerCase().includes(searchTerm) || 
                c.description?.toLowerCase().includes(searchTerm) ||
                c.company?.toLowerCase().includes(searchTerm)
            );
            displayFilteredResults(filtered);
        }

        function searchProgress() {
            const searchTerm = document.getElementById('progressSearchInput').value.toLowerCase();
            const filtered = contracts.filter(c => 
                c.title?.toLowerCase().includes(searchTerm) || 
                c.description?.toLowerCase().includes(searchTerm) ||
                c.company?.toLowerCase().includes(searchTerm)
            );
            displayFilteredResults(filtered);
        }

        function displayFilteredResults(filtered) {
            if (currentPage === 'home') {
                const grid = document.getElementById('contractsGrid');
                if (filtered.length === 0) {
                    grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 50px; color: #999;">No contracts found</div>';
                } else {
                    grid.innerHTML = filtered.map(contract => `
                        <div class="contract-card" data-status="${contract.status}" onclick="viewContract('${contract.id}')">
                            <div class="contract-amount">‚Ç¶${parseFloat(contract.amount).toLocaleString()}</div>
                            <div class="contract-title">${contract.title || contract.description?.substring(0, 30) + '...'}</div>
                            <div class="contract-company">at ${contract.company}</div>
                            <div class="contract-meta">
                                <span class="status-badge ${contract.status?.toLowerCase().replace(' ', '-')}">${contract.status}</span>
                                <span>üìÖ ${new Date(contract.submissionDate).toLocaleDateString()}</span>
                            </div>
                        </div>
                    `).join('');
                }
            } else {
                const list = document.getElementById('progressList');
                if (filtered.length === 0) {
                    list.innerHTML = '<div style="text-align: center; padding: 50px; color: #999;">No contracts found</div>';
                } else {
                    list.innerHTML = filtered.map(contract => `
                        <div class="progress-item" onclick="viewContract('${contract.id}')">
                            <div class="progress-status ${contract.status?.toLowerCase().replace(' ', '-')}"></div>
                            <div class="progress-content">
                                <div class="progress-title">
                                    <span style="font-weight: 600;">${contract.status?.toUpperCase()}</span> ‚Äî ${contract.title || contract.description?.substring(0, 30) + '...'}
                                </div>
                                <div class="progress-date">Posted on ${new Date(contract.submissionDate).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</div>
                            </div>
                        </div>
                    `).join('');
                }
            }
        }

        // ==================== PAGE NAVIGATION ====================
        function showPage(page) {
            currentPage = page;
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (page === 'home') {
                document.getElementById('homePage').style.display = 'block';
                document.getElementById('progressPage').style.display = 'none';
            } else {
                document.getElementById('homePage').style.display = 'none';
                document.getElementById('progressPage').style.display = 'block';
            }
        }

        // ==================== FILTER MODAL ====================
        function openFilterModal() {
            document.getElementById('filterModal').style.display = 'flex';
        }

        function closeFilterModal() {
            document.getElementById('filterModal').style.display = 'none';
        }

        function selectFilter(status) {
            currentFilter = status;
            document.querySelectorAll('.filter-option').forEach(opt => opt.classList.remove('selected'));
            const filterId = status === 'all' ? 'filterAll' : `filter${status.replace(' ', '')}`;
            document.getElementById(filterId).classList.add('selected');
        }

        function applyFilter() {
            closeFilterModal();
            displayContracts();
            displayProgress();
        }

        function clearFilter() {
            currentFilter = 'all';
            document.querySelectorAll('.filter-option').forEach(opt => opt.classList.remove('selected'));
            document.getElementById('filterAll').classList.add('selected');
            displayContracts();
            displayProgress();
        }

        // ==================== ADD CONTRACT MODAL ====================
        function openAddModal() {
            document.getElementById('addModal').style.display = 'block';
        }

        function closeAddModal() {
            document.getElementById('addModal').style.display = 'none';
            document.getElementById('addContractForm').reset();
            document.getElementById('imagePreview').innerHTML = '<span style="color: #999;">Choose an image...</span>';
        }

        async function saveNewContract(event) {
            event.preventDefault();
            
            const description = document.getElementById('description').value;
            const title = description.split(' ').slice(0, 4).join(' ') + '...';
            
            const newContract = {
                amount: document.getElementById('amount').value,
                title: title,
                company: document.getElementById('company').value,
                status: document.getElementById('status').value,
                submissionDate: document.getElementById('submissionDate').value,
                duration: document.getElementById('duration').value,
                description: description,
                workerId: document.getElementById('workerId').value,
                submittedBy: 'Community Member',
                submittedEmail: 'member@kro.com',
                avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Member'
            };

            const imageFile = document.getElementById('contractImage').files[0];
            if (imageFile) {
                try {
                    const imageUrl = await uploadImage(imageFile);
                    newContract.image_url = imageUrl;
                } catch (error) {
                    console.error('Image upload failed:', error);
                }
            }

            try {
                const { data, error } = await supabase
                    .from('contracts')
                    .insert([newContract])
                    .select();
                
                if (error) throw error;
                
                closeAddModal();
                loadContracts();
                alert('Contract created successfully!');
            } catch (error) {
                console.error('Error saving contract:', error);
                alert('Error saving contract. Please try again.');
            }
        }

        // ==================== IMAGE UPLOAD ====================
        async function uploadImage(file) {
            const fileName = `${Date.now()}_${file.name}`;
            
            const { data, error } = await supabase.storage
                .from('contract-images')
                .upload(fileName, file);
            
            if (error) throw error;
            
            const { data: { publicUrl } } = supabase.storage
                .from('contract-images')
                .getPublicUrl(fileName);
            
            return publicUrl;
        }

        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            }
        }

        function previewEditImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('editImagePreview').innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            }
        }

        // ==================== CONTRACT DETAIL ====================
        async function viewContract(id) {
            selectedContract = id;
            
            try {
                const { data: contract, error } = await supabase
                    .from('contracts')
                    .select('*')
                    .eq('id', id)
                    .single();
                
                if (error) throw error;
                
                document.getElementById('detailTitle').textContent = contract.title || 'Contract Details';
                document.getElementById('detailContent').innerHTML = `
                    <div class="detail-row">
                        <div class="detail-label">Contract Details</div>
                        <div class="detail-value">${contract.duration || 'N/A'}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Description</div>
                        <div class="detail-value">${contract.description || 'N/A'}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Duration</div>
                        <div class="detail-value">${contract.duration || 'N/A'}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Status</div>
                        <div class="detail-value">
                            <span class="status-badge ${contract.status?.toLowerCase().replace(' ', '-')}">${contract.status || 'N/A'}</span>
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Amount</div>
                        <div class="detail-value">‚Ç¶${contract.amount ? parseFloat(contract.amount).toLocaleString() : '0'}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Submission Date</div>
                        <div class="detail-value">${contract.submissionDate ? new Date(contract.submissionDate).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) : 'N/A'}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Submitted By</div>
                        <div class="detail-value">
                            <div class="submitted-by">
                                <img src="${contract.avatar || 'https://api.dicebear.com/7.x/avataaars/svg?seed=User'}" alt="">
                                <div class="submitted-info">
                                    <h4>${contract.submittedBy || 'Community Member'}</h4>
                                    <p>${contract.submittedEmail || ''}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Pre-fill edit form
                document.getElementById('editContractId').value = contract.id;
                document.getElementById('editDescription').value = contract.description || '';
                document.getElementById('editDuration').value = contract.duration || '';
                document.getElementById('editWorkerId').value = contract.workerId || '';
                document.getElementById('editAmount').value = contract.amount || '';
                document.getElementById('editStatus').value = contract.status || 'Not Started';
                document.getElementById('editSubmissionDate').value = contract.submissionDate || '';
                
                // Pre-fill status modal
                document.getElementById('statusContractId').value = contract.id;
                document.getElementById('newStatus').value = contract.status || 'Not Started';
                
                document.getElementById('detailModal').style.display = 'block';
            } catch (error) {
                console.error('Error loading contract:', error);
                alert('Error loading contract details');
            }
        }

        function closeDetailModal() {
            document.getElementById('detailModal').style.display = 'none';
        }

        // ==================== EDIT CONTRACT ====================
        function openEditModal() {
            closeDetailModal();
            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        async function updateContract(event) {
            event.preventDefault();
            
            const id = document.getElementById('editContractId').value;
            const description = document.getElementById('editDescription').value;
            
            const updates = {
                description: description,
                duration: document.getElementById('editDuration').value,
                workerId: document.getElementById('editWorkerId').value,
                amount: document.getElementById('editAmount').value,
                status: document.getElementById('editStatus').value,
                submissionDate: document.getElementById('editSubmissionDate').value,
                title: description.split(' ').slice(0, 4).join(' ') + '...'
            };

            const imageFile = document.getElementById('editImage').files[0];
            if (imageFile) {
                try {
                    const imageUrl = await uploadImage(imageFile);
                    updates.image_url = imageUrl;
                } catch (error) {
                    console.error('Image upload failed:', error);
                }
            }

            try {
                const { error } = await supabase
                    .from('contracts')
                    .update(updates)
                    .eq('id', id);
                
                if (error) throw error;
                
                closeEditModal();
                loadContracts();
                alert('Contract updated successfully!');
            } catch (error) {
                console.error('Error updating contract:', error);
                alert('Error updating contract');
            }
        }

        // ==================== UPDATE STATUS ====================
        function openUpdateStatusModal() {
            closeDetailModal();
            document.getElementById('statusModal').style.display = 'block';
        }

        function closeStatusModal() {
            document.getElementById('statusModal').style.display = 'none';
        }

        async function updateContractStatus(event) {
            event.preventDefault();
            
            const id = document.getElementById('statusContractId').value;
            const newStatus = document.getElementById('newStatus').value;

            try {
                const { error } = await supabase
                    .from('contracts')
                    .update({ status: newStatus })
                    .eq('id', id);
                
                if (error) throw error;
                
                closeStatusModal();
                loadContracts();
                alert('Status updated successfully!');
            } catch (error) {
                console.error('Error updating status:', error);
                alert('Error updating status');
            }
        }

        // ==================== YOUTUBE BANNERS ====================
        function initBanners() {
            youtubeCreators = creators;
            loadBanners();
            startBannerSlide();
        }

        function loadBanners() {
            const slider = document.getElementById('bannersSlider');
            const controls = document.getElementById('sliderControls');
            
            slider.innerHTML = youtubeCreators.map((creator, index) => `
                <div class="banner-slide">
                    <div class="youtube-banner" onclick="window.open('${creator.link}', '_blank')" style="background: ${creator.color}">
                        <div class="banner-content">
                            <h3>${creator.name}</h3>
                            <p>${creator.description}</p>
                            <div class="banner-stats">
                                <div class="stat">
                                    <div class="stat-number">${creator.subscribers}</div>
                                    <div class="stat-label">Subscribers</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-number">${creator.videos}</div>
                                    <div class="stat-label">Videos</div>
                                </div>
                            </div>
                            <span class="banner-button">Subscribe ‚Üí</span>
                        </div>
                        <div class="banner-avatar">
                            ${creator.avatar}
                        </div>
                    </div>
                </div>
            `).join('');
            
            controls.innerHTML = youtubeCreators.map((_, index) => `
                <div class="slider-dot ${index === 0 ? 'active' : ''}" onclick="goToBanner(${index})"></div>
            `).join('');
        }

        function startBannerSlide() {
            bannerInterval = setInterval(() => {
                currentBannerIndex = (currentBannerIndex + 1) % youtubeCreators.length;
                updateBannerPosition();
            }, 5000);
        }

        function goToBanner(index) {
            currentBannerIndex = index;
            updateBannerPosition();
            
            clearInterval(bannerInterval);
            startBannerSlide();
        }

        function updateBannerPosition() {
            const slider = document.getElementById('bannersSlider');
            slider.style.transform = `translateX(-${currentBannerIndex * 100}%)`;
            
            document.querySelectorAll('.slider-dot').forEach((dot, index) => {
                if (index === currentBannerIndex) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }

        // ==================== INITIALIZATION ====================
        window.onload = function() {
            loadContracts();
            initBanners();
            
            // Check if user already completed onboarding
            if (hasCompletedOnboarding) {
                console.log('User already completed onboarding');
            }
        };
    </script>
</body>
</html>